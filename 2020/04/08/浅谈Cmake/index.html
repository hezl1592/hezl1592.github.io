<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="zilch"><title>CMAKE | Cmake与开发 · zilch个人博客</title><meta name="description" content="CMake是个一个开源的跨平台自动化建构系统，用来管理软件建置的程序，并不相依于某特定编译器。可以用简单的语句来描述所有平台的安装(编译过程)。他能够输出各种各样的Makefile或者project文件，CMake 并不直接建构出最终的软件，而是产生标准的建构档（如Unix的Makefile或pro"><meta name="keywords" content="博客,Hexo,车辆工程,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 4.2.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">zilch个人博客</a></h3><div class="description"><p>言念君子，温其如玉</p></div></div></div><ul class="social-links"><li><a href="https://github.com/hezl1592" target="_blank" rel="noopener"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me" target="_blank" rel="noopener"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole" target="_blank" rel="noopener"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>CMAKE | Cmake与开发</a></h3></div><div class="post-content"><p>CMake是个一个开源的跨平台<strong>自动化建构</strong>系统，用来管理软件建置的程序，并不相依于某特定编译器。可以用简单的语句来描述所有平台的安装(编译过程)。他能够输出各种各样的Makefile或者project文件，CMake 并不直接建构出最终的软件，而是产生标准的建构档（如Unix的Makefile或projects），然后再依一般的建构方式使用。</p>
<h3 id="1-基本模板"><a href="#1-基本模板" class="headerlink" title="1. 基本模板"></a>1. 基本模板</h3><p>Cmake的基础便是<strong>CMakeLists.txt</strong>文件，一般：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmake版本要求</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span> (VERSION <span class="number">2.8</span>)</span><br><span class="line"><span class="comment"># 当前工程名称</span></span><br><span class="line"><span class="keyword">project</span>(main)</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">""</span>)</span><br><span class="line"><span class="comment"># 资源目录</span></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"SOURCE DIR: "</span> <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置源文件变量, 并添加文件（多个）</span></span><br><span class="line"><span class="comment"># set(src_list xxx.cpp xxx.cpp xx.cpp)</span></span><br><span class="line"><span class="keyword">set</span>(src_list main.cpp <span class="number">1</span>.cpp)</span><br><span class="line"><span class="comment"># 目标可执行文件</span></span><br><span class="line"><span class="comment"># 可执行文件的输出目录</span></span><br><span class="line"><span class="keyword">SET</span>(EXECUTABLE_OUTPUT_PATH <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/bin)</span><br><span class="line"><span class="keyword">set</span>(target_file <span class="variable">$&#123;PROJECT_NAME&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印提示信息</span></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"SOURCE: "</span> <span class="variable">$&#123;src_list&#125;</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"TARGET: "</span> <span class="variable">$&#123;EXECUTABLE_OUTPUT_PATH&#125;</span>/<span class="variable">$&#123;target_file&#125;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置C++编译参数(CMAKE_CXX_FLAGS是全局变量)</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">"-Wall -std=c++11"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定头文件目录位置</span></span><br><span class="line"><span class="comment"># INCLUDE_DIRECTORIES($&#123;PROJECT_SOURCE_DIR&#125;/include)</span></span><br><span class="line"><span class="comment">#添加共享库搜索路径</span></span><br><span class="line"><span class="comment"># LINK_DIRECTORIES($&#123;PROJECT_SOURCE_DIR&#125;/lib)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置头文件位置，相当于g++ -I，可以用相对或绝对路径，也可以用自定义的变量值</span></span><br><span class="line"><span class="comment"># include_directories($&#123;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用给定的源文件，为工程引入一个可执行文件test。</span></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">$&#123;target_file&#125;</span> <span class="variable">$&#123;src_list&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>编译的时候，当源文件很多的时候，可以使用 <code>aux_source_directory</code> 命令，该命令会查找指定目录下的所有源文件，然后将结果存进指定变量名。其语法如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">aux_source_directory</span>(&lt;dir&gt; &lt;variable&gt;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">aux_source_directory</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span> DIR_SRCS)</span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">$&#123;target_file&#125;</span> <span class="variable">$&#123;src_list&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>这样，CMake 会将当前目录所有源文件的文件名赋值给变量 <code>DIR_SRCS</code> ，再指示变量 <code>DIR_SRCS</code> 中的源文件需要编译成一个名称为 CMakeDemo的可执行文件。</p>
<h3 id="2-生成库文件"><a href="#2-生成库文件" class="headerlink" title="2. 生成库文件"></a>2. 生成库文件</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;name&#125;</span> <span class="variable">$&#123;source&#125;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>库文件</strong>是事先编译好的方法的合集。比如：我们提前写好一些数据公式的实现，将其打包成库文件，以后使用只需要库文件就可以，不需要重新编写。</p>
<p>库文件分两种：静态库和动态库（也叫共享库）</p>
<ul>
<li>Windows系统静态库扩展名为：.lib，动态库扩展名为.dll；</li>
<li>Linux系统下静态库的扩展名为.a，动态库的扩展名为.so；</li>
</ul>
<ol>
<li><strong>Cmake生成静态库</strong></li>
</ol>
<p>静态库（也称作归档文件），程序在链接的过程中，链接器从库文件中取得所需代码，复制到生成的可执行文件中。因此，<strong>静态库是在程序员的链接阶段被复制到程序当中</strong>，和程序的执行没有任何关系。</p>
<p>这类库在编译的时候会<strong>直接整合到目标程序中</strong>，所以利用静态函数库编译成的文件会比较大，这类函数库最大的优点就是编译成功的可执行文件可以独立运行，而不再需要向外部要求读取函数库的内容；</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmake版本要求</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span> (VERSION <span class="number">2.8</span>)</span><br><span class="line"><span class="comment"># 当前工程名称</span></span><br><span class="line"><span class="keyword">project</span>(sub)</span><br><span class="line"></span><br><span class="line"><span class="keyword">aux_source_directory</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span> DIR_SRCS)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"SOURCE: "</span> <span class="variable">$&#123;DIR_SRCS&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里就是关键，生成静态库（默认）</span></span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> <span class="variable">$&#123;DIR_SRCS&#125;</span>)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>Cmake生成动态库</strong></li>
</ol>
<p>与静态函数库被整个捕捉到程序中不同，动态函数库在编译的时候，在程序里只有一个“指向”的位置而已，也就是说当可执行文件需要使用到函数库的机制时，程序才会去读取函数库来使用；也就是说可执行文件无法单独运行。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmake版本要求</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span> (VERSION <span class="number">2.8</span>)</span><br><span class="line"><span class="comment"># 当前工程名称</span></span><br><span class="line"><span class="keyword">project</span>(sub)</span><br><span class="line"></span><br><span class="line"><span class="keyword">aux_source_directory</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span> DIR_SRCS)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"SOURCE: "</span> <span class="variable">$&#123;DIR_SRCS&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里就是关键，生成动态库！SHARED</span></span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> SHARED <span class="variable">$&#123;DIR_SRCS&#125;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-链接库"><a href="#3-链接库" class="headerlink" title="3. 链接库"></a>3. 链接库</h3><ul>
<li><strong>link_directories</strong></li>
</ul>
<p>该指令的作用主要是指定要链接的库文件的<strong>路径</strong>，该指令有时候<strong>不一定需要</strong>。因为find_package和find_library指令可以得到库文件的绝对路径。不过你自己写的动态库文件放在自己新建的目录下时，可以用该指令指定该目录的路径以便工程能够找到。</p>
<ul>
<li><strong>target_link_libraries</strong></li>
</ul>
<p>该指令的作用为将目标文件与库文件进行链接。该指令的语法如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(&lt;<span class="keyword">target</span>&gt; [item1] [item2] [...]</span><br><span class="line">                      [[debug|optimized|general] &lt;item&gt;] ...)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>示例</strong></li>
</ul>
<p>假设我们需要寻找当前目录中lib/libmath.so，则CMakeLIsts.txt:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加库目录</span></span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/lib)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加链接库libmath.so or libmath.a</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> <span class="keyword">math</span>)</span><br></pre></td></tr></table></figure>

<h3 id="4-外部项目"><a href="#4-外部项目" class="headerlink" title="4. 外部项目"></a>4. 外部项目</h3><p>当当前编译的项目需要外部文件支持时，可以将外部文件编译为静态链接库，然后链接到目标，</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加外部文件夹，并执行该文件夹下方的CMakeLists.txt</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(sub1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加静态库，sub-&gt;实际中：libsub.a</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;target_file&#125;</span> sub)</span><br></pre></td></tr></table></figure>

<p>同时，外部文件夹sub1中，同样需要CMakeLIsts.txt文件：例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmake版本要求</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span> (VERSION <span class="number">2.8</span>)</span><br><span class="line"><span class="comment"># 当前工程名称</span></span><br><span class="line"><span class="keyword">project</span>(sub)</span><br><span class="line"></span><br><span class="line"><span class="keyword">aux_source_directory</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span> DIR_SRCS)</span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> <span class="variable">$&#123;DIR_SRCS&#125;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="cmake-clean"><a href="#cmake-clean" class="headerlink" title="cmake clean"></a>cmake clean</h3><p>cmake没有提供类似Makefile中clean的命令，因此可以在源文件同级目录下写一个Makefile，内容如下：<a href="https://blog.csdn.net/coldplayplay/article/details/78508883?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1&utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1" target="_blank" rel="noopener">CSDN-coldplayplay</a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">BUILD_DIR = ./build</span><br><span class="line">DEST_DIR = ./bin</span><br><span class="line">DEST_EXE_NAME = main</span><br><span class="line"></span><br><span class="line"><span class="section">all: build</span></span><br><span class="line">    cd <span class="variable">$(BUILD_DIR)</span>;  make -j4</span><br><span class="line"><span class="section">run:</span></span><br><span class="line">    cd <span class="variable">$(DEST_DIR)</span>; ./<span class="variable">$(DEST_EXE_NAME)</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm <span class="variable">$(BUILD_DIR)</span> -rf</span><br><span class="line"><span class="section">build:</span></span><br><span class="line">    mkdir <span class="variable">$(BUILD_DIR)</span>;cd <span class="variable">$(BUILD_DIR)</span>; cmake ..</span><br></pre></td></tr></table></figure>

<h3 id="cmake基础部分大概如此，更加进阶的基于基础在实战中进步！"><a href="#cmake基础部分大概如此，更加进阶的基于基础在实战中进步！" class="headerlink" title="cmake基础部分大概如此，更加进阶的基于基础在实战中进步！"></a>cmake基础部分大概如此，更加进阶的基于基础在实战中进步！</h3></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-04-08</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Cmake/" title="Cmake">Cmake </a><a class="tag" href="/tags/编译/" title="编译">编译 </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://yoursite.com/2020/04/08/浅谈Cmake/,zilch个人博客,CMAKE | Cmake与开发,;" target="_blank" rel="noopener"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2020/04/07/python%E7%B1%BB/" title="python | 浅谈Python类">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>